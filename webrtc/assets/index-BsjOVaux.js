var ko=Object.defineProperty;var Tn=e=>{throw TypeError(e)};var No=(e,t,n)=>t in e?ko(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var $=(e,t,n)=>No(e,typeof t!="symbol"?t+"":t,n),Un=(e,t,n)=>t.has(e)||Tn("Cannot "+n);var F=(e,t,n)=>(Un(e,t,"read from private field"),n?n.call(e):t.get(e)),mt=(e,t,n)=>t.has(e)?Tn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),xt=(e,t,n,r)=>(Un(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function $n(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Jn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Oo(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");$n(e.outputLen),$n(e.blockLen)}function Qe(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ho(e,t){Jn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const vt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Yn=e=>e instanceof Uint8Array,At=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),re=(e,t)=>e<<32-t|e>>>t,Po=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Po)throw new Error("Non little-endian hardware is not supported");function qo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Ft(e){if(typeof e=="string"&&(e=qo(e)),!Yn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Mo(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!Yn(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let Xn=class{clone(){return this._cloneInto()}};function Do(e){const t=r=>e().update(Ft(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Qn(e=32){if(vt&&typeof vt.getRandomValues=="function")return vt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function jo(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,f=r?0:4;e.setUint32(t+a,s,r),e.setUint32(t+f,c,r)}let zo=class extends Xn{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=At(this.buffer)}update(t){Qe(this);const{view:n,buffer:r,blockLen:o}=this;t=Ft(t);const i=t.length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=At(t);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(t.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Qe(this),Ho(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;jo(r,o-8,BigInt(this.length*8),i),this.process(r,0);const c=At(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=a/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)c.setUint32(4*l,u[l],i)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return t.length=o,t.pos=c,t.finished=i,t.destroyed=s,o%n&&t.buffer.set(r),t}};const Vo=(e,t,n)=>e&t^~e&n,Ko=(e,t,n)=>e&t^e&n^t&n,Wo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),we=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),be=new Uint32Array(64);let Zo=class extends zo{constructor(){super(64,32,8,!1),this.A=we[0]|0,this.B=we[1]|0,this.C=we[2]|0,this.D=we[3]|0,this.E=we[4]|0,this.F=we[5]|0,this.G=we[6]|0,this.H=we[7]|0}get(){const{A:t,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[t,n,r,o,i,s,c,a]}set(t,n,r,o,i,s,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)be[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const w=be[l-15],b=be[l-2],y=re(w,7)^re(w,18)^w>>>3,d=re(b,17)^re(b,19)^b>>>10;be[l]=d+be[l-7]+y+be[l-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:f,H:u}=this;for(let l=0;l<64;l++){const w=re(c,6)^re(c,11)^re(c,25),b=u+w+Vo(c,a,f)+Wo[l]+be[l]|0,d=(re(r,2)^re(r,13)^re(r,22))+Ko(r,o,i)|0;u=f,f=a,a=c,c=s+b|0,s=i,i=o,o=r,r=b+d|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,o,i,s,c,a,f,u)}roundClean(){be.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Ct=Do(()=>new Zo);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const er=BigInt(0),ot=BigInt(1),Fo=BigInt(2),it=e=>e instanceof Uint8Array,Go=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function He(e){if(!it(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Go[e[n]];return t}function tr(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function Gt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Pe(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,i=e.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function G(e){return Gt(He(e))}function Jt(e){if(!it(e))throw new Error("Uint8Array expected");return Gt(He(Uint8Array.from(e).reverse()))}function Se(e,t){return Pe(e.toString(16).padStart(t*2,"0"))}function Yt(e,t){return Se(e,t).reverse()}function Jo(e){return Pe(tr(e))}function K(e,t,n){let r;if(typeof t=="string")try{r=Pe(t)}catch(i){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${i}`)}else if(it(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function Te(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!it(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function Yo(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Xo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Qo(e){let t;for(t=0;e>er;e>>=ot,t+=1);return t}function ei(e,t){return e>>BigInt(t)&ot}const ti=(e,t,n)=>e|(n?ot:er)<<BigInt(t),Xt=e=>(Fo<<BigInt(e-1))-ot,St=e=>new Uint8Array(e),Rn=e=>Uint8Array.from(e);function nr(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=St(e),o=St(e),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},c=(...l)=>n(o,r,...l),a=(l=St())=>{o=c(Rn([0]),l),r=c(),l.length!==0&&(o=c(Rn([1]),l),r=c())},f=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const w=[];for(;l<t;){r=c();const b=r.slice();w.push(b),l+=r.length}return Te(...w)};return(l,w)=>{s(),a(l);let b;for(;!(b=w(f()));)a();return s(),b}}const ni={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Je(e,t,n={}){const r=(o,i,s)=>{const c=ni[i];if(typeof c!="function")throw new Error(`Invalid validator "${i}", expected function`);const a=e[o];if(!(s&&a===void 0)&&!c(a,e))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${i}`)};for(const[o,i]of Object.entries(t))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return e}const ri=Object.freeze(Object.defineProperty({__proto__:null,bitGet:ei,bitLen:Qo,bitMask:Xt,bitSet:ti,bytesToHex:He,bytesToNumberBE:G,bytesToNumberLE:Jt,concatBytes:Te,createHmacDrbg:nr,ensureBytes:K,equalBytes:Yo,hexToBytes:Pe,hexToNumber:Gt,numberToBytesBE:Se,numberToBytesLE:Yt,numberToHexUnpadded:tr,numberToVarBytesBE:Jo,utf8ToBytes:Xo,validateObject:Je},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const z=BigInt(0),j=BigInt(1),Ie=BigInt(2),oi=BigInt(3),kt=BigInt(4),Cn=BigInt(5),kn=BigInt(8);BigInt(9);BigInt(16);function V(e,t){const n=e%t;return n>=z?n:t+n}function ii(e,t,n){if(n<=z||t<z)throw new Error("Expected power/modulo > 0");if(n===j)return z;let r=j;for(;t>z;)t&j&&(r=r*e%n),e=e*e%n,t>>=j;return r}function Y(e,t,n){let r=e;for(;t-- >z;)r*=r,r%=n;return r}function Nt(e,t){if(e===z||t<=z)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=V(e,t),r=t,o=z,i=j;for(;n!==z;){const c=r/n,a=r%n,f=o-i*c;r=n,n=a,o=i,i=f}if(r!==j)throw new Error("invert: does not exist");return V(o,t)}function si(e){const t=(e-j)/Ie;let n,r,o;for(n=e-j,r=0;n%Ie===z;n/=Ie,r++);for(o=Ie;o<e&&ii(o,t,e)!==e-j;o++);if(r===1){const s=(e+j)/kt;return function(a,f){const u=a.pow(f,s);if(!a.eql(a.sqr(u),f))throw new Error("Cannot find square root");return u}}const i=(n+j)/Ie;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let f=r,u=c.pow(c.mul(c.ONE,o),n),l=c.pow(a,i),w=c.pow(a,n);for(;!c.eql(w,c.ONE);){if(c.eql(w,c.ZERO))return c.ZERO;let b=1;for(let d=c.sqr(w);b<f&&!c.eql(d,c.ONE);b++)d=c.sqr(d);const y=c.pow(u,j<<BigInt(f-b-1));u=c.sqr(y),l=c.mul(l,y),w=c.mul(w,u),f=b}return l}}function ai(e){if(e%kt===oi){const t=(e+j)/kt;return function(r,o){const i=r.pow(o,t);if(!r.eql(r.sqr(i),o))throw new Error("Cannot find square root");return i}}if(e%kn===Cn){const t=(e-Cn)/kn;return function(r,o){const i=r.mul(o,Ie),s=r.pow(i,t),c=r.mul(o,s),a=r.mul(r.mul(c,Ie),s),f=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(f),o))throw new Error("Cannot find square root");return f}}return si(e)}const ci=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function li(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=ci.reduce((r,o)=>(r[o]="function",r),t);return Je(e,n)}function fi(e,t,n){if(n<z)throw new Error("Expected power > 0");if(n===z)return e.ONE;if(n===j)return t;let r=e.ONE,o=t;for(;n>z;)n&j&&(r=e.mul(r,o)),o=e.sqr(o),n>>=j;return r}function ui(e,t){const n=new Array(t.length),r=t.reduce((i,s,c)=>e.is0(s)?i:(n[c]=i,e.mul(i,s)),e.ONE),o=e.inv(r);return t.reduceRight((i,s,c)=>e.is0(s)?i:(n[c]=e.mul(i,n[c]),e.mul(i,s)),o),n}function rr(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function di(e,t,n=!1,r={}){if(e<=z)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:i}=rr(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=ai(e),c=Object.freeze({ORDER:e,BITS:o,BYTES:i,MASK:Xt(o),ZERO:z,ONE:j,create:a=>V(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return z<=a&&a<e},is0:a=>a===z,isOdd:a=>(a&j)===j,neg:a=>V(-a,e),eql:(a,f)=>a===f,sqr:a=>V(a*a,e),add:(a,f)=>V(a+f,e),sub:(a,f)=>V(a-f,e),mul:(a,f)=>V(a*f,e),pow:(a,f)=>fi(c,a,f),div:(a,f)=>V(a*Nt(f,e),e),sqrN:a=>a*a,addN:(a,f)=>a+f,subN:(a,f)=>a-f,mulN:(a,f)=>a*f,inv:a=>Nt(a,e),sqrt:r.sqrt||(a=>s(c,a)),invertBatch:a=>ui(c,a),cmov:(a,f,u)=>u?f:a,toBytes:a=>n?Yt(a,i):Se(a,i),fromBytes:a=>{if(a.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${a.length}`);return n?Jt(a):G(a)}});return Object.freeze(c)}function or(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function ir(e){const t=or(e);return t+Math.ceil(t/2)}function hi(e,t,n=!1){const r=e.length,o=or(t),i=ir(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const s=n?G(e):Jt(e),c=V(s,t-j)+j;return n?Yt(c,o):Se(c,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const pi=BigInt(0),Bt=BigInt(1);function gi(e,t){const n=(o,i)=>{const s=i.negate();return o?s:i},r=o=>{const i=Math.ceil(t/o)+1,s=2**(o-1);return{windows:i,windowSize:s}};return{constTimeNegate:n,unsafeLadder(o,i){let s=e.ZERO,c=o;for(;i>pi;)i&Bt&&(s=s.add(c)),c=c.double(),i>>=Bt;return s},precomputeWindow(o,i){const{windows:s,windowSize:c}=r(i),a=[];let f=o,u=f;for(let l=0;l<s;l++){u=f,a.push(u);for(let w=1;w<c;w++)u=u.add(f),a.push(u);f=u.double()}return a},wNAF(o,i,s){const{windows:c,windowSize:a}=r(o);let f=e.ZERO,u=e.BASE;const l=BigInt(2**o-1),w=2**o,b=BigInt(o);for(let y=0;y<c;y++){const d=y*a;let h=Number(s&l);s>>=b,h>a&&(h-=w,s+=Bt);const p=d,x=d+Math.abs(h)-1,B=y%2!==0,R=h<0;h===0?u=u.add(n(B,i[p])):f=f.add(n(R,i[x]))}return{p:f,f:u}},wNAFCached(o,i,s,c){const a=o._WINDOW_SIZE||1;let f=i.get(o);return f||(f=this.precomputeWindow(o,a),a!==1&&i.set(o,c(f))),this.wNAF(a,f,s)}}}function sr(e){return li(e.Fp),Je(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...rr(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function yi(e){const t=sr(e);Je(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:wi,hexToBytes:bi}=ri,Le={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=Le;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:wi(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=Le,n=typeof e=="string"?bi(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:i}=Le._parseInt(n.subarray(2)),{d:s,l:c}=Le._parseInt(i);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s}},hexFromSig(e){const t=f=>Number.parseInt(f[0],16)&8?"00"+f:f,n=f=>{const u=f.toString(16);return u.length&1?`0${u}`:u},r=t(n(e.s)),o=t(n(e.r)),i=r.length/2,s=o.length/2,c=n(i),a=n(s);return`30${n(s+i+4)}02${a}${o}02${c}${r}`}},ce=BigInt(0),X=BigInt(1);BigInt(2);const Nn=BigInt(3);BigInt(4);function Ei(e){const t=yi(e),{Fp:n}=t,r=t.toBytes||((y,d,h)=>{const p=d.toAffine();return Te(Uint8Array.from([4]),n.toBytes(p.x),n.toBytes(p.y))}),o=t.fromBytes||(y=>{const d=y.subarray(1),h=n.fromBytes(d.subarray(0,n.BYTES)),p=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:h,y:p}});function i(y){const{a:d,b:h}=t,p=n.sqr(y),x=n.mul(p,y);return n.add(n.add(x,n.mul(y,d)),h)}if(!n.eql(n.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function s(y){return typeof y=="bigint"&&ce<y&&y<t.n}function c(y){if(!s(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(y){const{allowedPrivateKeyLengths:d,nByteLength:h,wrapPrivateKey:p,n:x}=t;if(d&&typeof y!="bigint"){if(y instanceof Uint8Array&&(y=He(y)),typeof y!="string"||!d.includes(y.length))throw new Error("Invalid key");y=y.padStart(h*2,"0")}let B;try{B=typeof y=="bigint"?y:G(K("private key",y,h))}catch{throw new Error(`private key must be ${h} bytes, hex or bigint, not ${typeof y}`)}return p&&(B=V(B,x)),c(B),B}const f=new Map;function u(y){if(!(y instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(d,h,p){if(this.px=d,this.py=h,this.pz=p,d==null||!n.isValid(d))throw new Error("x required");if(h==null||!n.isValid(h))throw new Error("y required");if(p==null||!n.isValid(p))throw new Error("z required")}static fromAffine(d){const{x:h,y:p}=d||{};if(!d||!n.isValid(h)||!n.isValid(p))throw new Error("invalid affine point");if(d instanceof l)throw new Error("projective point not allowed");const x=B=>n.eql(B,n.ZERO);return x(h)&&x(p)?l.ZERO:new l(h,p,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const h=n.invertBatch(d.map(p=>p.pz));return d.map((p,x)=>p.toAffine(h[x])).map(l.fromAffine)}static fromHex(d){const h=l.fromAffine(o(K("pointHex",d)));return h.assertValidity(),h}static fromPrivateKey(d){return l.BASE.multiply(a(d))}_setWindowSize(d){this._WINDOW_SIZE=d,f.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:h}=this.toAffine();if(!n.isValid(d)||!n.isValid(h))throw new Error("bad point: x or y not FE");const p=n.sqr(h),x=i(d);if(!n.eql(p,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){u(d);const{px:h,py:p,pz:x}=this,{px:B,py:R,pz:L}=d,m=n.eql(n.mul(h,L),n.mul(B,x)),v=n.eql(n.mul(p,L),n.mul(R,x));return m&&v}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:d,b:h}=t,p=n.mul(h,Nn),{px:x,py:B,pz:R}=this;let L=n.ZERO,m=n.ZERO,v=n.ZERO,A=n.mul(x,x),q=n.mul(B,B),U=n.mul(R,R),_=n.mul(x,B);return _=n.add(_,_),v=n.mul(x,R),v=n.add(v,v),L=n.mul(d,v),m=n.mul(p,U),m=n.add(L,m),L=n.sub(q,m),m=n.add(q,m),m=n.mul(L,m),L=n.mul(_,L),v=n.mul(p,v),U=n.mul(d,U),_=n.sub(A,U),_=n.mul(d,_),_=n.add(_,v),v=n.add(A,A),A=n.add(v,A),A=n.add(A,U),A=n.mul(A,_),m=n.add(m,A),U=n.mul(B,R),U=n.add(U,U),A=n.mul(U,_),L=n.sub(L,A),v=n.mul(U,q),v=n.add(v,v),v=n.add(v,v),new l(L,m,v)}add(d){u(d);const{px:h,py:p,pz:x}=this,{px:B,py:R,pz:L}=d;let m=n.ZERO,v=n.ZERO,A=n.ZERO;const q=t.a,U=n.mul(t.b,Nn);let _=n.mul(h,B),O=n.mul(p,R),H=n.mul(x,L),M=n.add(h,p),g=n.add(B,R);M=n.mul(M,g),g=n.add(_,O),M=n.sub(M,g),g=n.add(h,x);let E=n.add(B,L);return g=n.mul(g,E),E=n.add(_,H),g=n.sub(g,E),E=n.add(p,x),m=n.add(R,L),E=n.mul(E,m),m=n.add(O,H),E=n.sub(E,m),A=n.mul(q,g),m=n.mul(U,H),A=n.add(m,A),m=n.sub(O,A),A=n.add(O,A),v=n.mul(m,A),O=n.add(_,_),O=n.add(O,_),H=n.mul(q,H),g=n.mul(U,g),O=n.add(O,H),H=n.sub(_,H),H=n.mul(q,H),g=n.add(g,H),_=n.mul(O,g),v=n.add(v,_),_=n.mul(E,g),m=n.mul(M,m),m=n.sub(m,_),_=n.mul(M,O),A=n.mul(E,A),A=n.add(A,_),new l(m,v,A)}subtract(d){return this.add(d.negate())}is0(){return this.equals(l.ZERO)}wNAF(d){return b.wNAFCached(this,f,d,h=>{const p=n.invertBatch(h.map(x=>x.pz));return h.map((x,B)=>x.toAffine(p[B])).map(l.fromAffine)})}multiplyUnsafe(d){const h=l.ZERO;if(d===ce)return h;if(c(d),d===X)return this;const{endo:p}=t;if(!p)return b.unsafeLadder(this,d);let{k1neg:x,k1:B,k2neg:R,k2:L}=p.splitScalar(d),m=h,v=h,A=this;for(;B>ce||L>ce;)B&X&&(m=m.add(A)),L&X&&(v=v.add(A)),A=A.double(),B>>=X,L>>=X;return x&&(m=m.negate()),R&&(v=v.negate()),v=new l(n.mul(v.px,p.beta),v.py,v.pz),m.add(v)}multiply(d){c(d);let h=d,p,x;const{endo:B}=t;if(B){const{k1neg:R,k1:L,k2neg:m,k2:v}=B.splitScalar(h);let{p:A,f:q}=this.wNAF(L),{p:U,f:_}=this.wNAF(v);A=b.constTimeNegate(R,A),U=b.constTimeNegate(m,U),U=new l(n.mul(U.px,B.beta),U.py,U.pz),p=A.add(U),x=q.add(_)}else{const{p:R,f:L}=this.wNAF(h);p=R,x=L}return l.normalizeZ([p,x])[0]}multiplyAndAddUnsafe(d,h,p){const x=l.BASE,B=(L,m)=>m===ce||m===X||!L.equals(x)?L.multiplyUnsafe(m):L.multiply(m),R=B(this,h).add(B(d,p));return R.is0()?void 0:R}toAffine(d){const{px:h,py:p,pz:x}=this,B=this.is0();d==null&&(d=B?n.ONE:n.inv(x));const R=n.mul(h,d),L=n.mul(p,d),m=n.mul(x,d);if(B)return{x:n.ZERO,y:n.ZERO};if(!n.eql(m,n.ONE))throw new Error("invZ was invalid");return{x:R,y:L}}isTorsionFree(){const{h:d,isTorsionFree:h}=t;if(d===X)return!0;if(h)return h(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:h}=t;return d===X?this:h?h(l,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return this.assertValidity(),r(l,this,d)}toHex(d=!0){return He(this.toRawBytes(d))}}l.BASE=new l(t.Gx,t.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const w=t.nBitLength,b=gi(l,t.endo?Math.ceil(w/2):w);return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:s}}function mi(e){const t=sr(e);return Je(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function xi(e){const t=mi(e),{Fp:n,n:r}=t,o=n.BYTES+1,i=2*n.BYTES+1;function s(g){return ce<g&&g<n.ORDER}function c(g){return V(g,r)}function a(g){return Nt(g,r)}const{ProjectivePoint:f,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:w}=Ei({...t,toBytes(g,E,S){const T=E.toAffine(),I=n.toBytes(T.x),C=Te;return S?C(Uint8Array.from([E.hasEvenY()?2:3]),I):C(Uint8Array.from([4]),I,n.toBytes(T.y))},fromBytes(g){const E=g.length,S=g[0],T=g.subarray(1);if(E===o&&(S===2||S===3)){const I=G(T);if(!s(I))throw new Error("Point is not on curve");const C=l(I);let P=n.sqrt(C);const N=(P&X)===X;return(S&1)===1!==N&&(P=n.neg(P)),{x:I,y:P}}else if(E===i&&S===4){const I=n.fromBytes(T.subarray(0,n.BYTES)),C=n.fromBytes(T.subarray(n.BYTES,2*n.BYTES));return{x:I,y:C}}else throw new Error(`Point of length ${E} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}}),b=g=>He(Se(g,t.nByteLength));function y(g){const E=r>>X;return g>E}function d(g){return y(g)?c(-g):g}const h=(g,E,S)=>G(g.slice(E,S));class p{constructor(E,S,T){this.r=E,this.s=S,this.recovery=T,this.assertValidity()}static fromCompact(E){const S=t.nByteLength;return E=K("compactSignature",E,S*2),new p(h(E,0,S),h(E,S,2*S))}static fromDER(E){const{r:S,s:T}=Le.toSig(K("DER",E));return new p(S,T)}assertValidity(){if(!w(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!w(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new p(this.r,this.s,E)}recoverPublicKey(E){const{r:S,s:T,recovery:I}=this,C=v(K("msgHash",E));if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");const P=I===2||I===3?S+t.n:S;if(P>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const N=I&1?"03":"02",ee=f.fromHex(N+b(P)),ge=a(P),Ue=c(-C*ge),Ke=c(T*ge),ye=f.BASE.multiplyAndAddUnsafe(ee,Ue,Ke);if(!ye)throw new Error("point at infinify");return ye.assertValidity(),ye}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Pe(this.toDERHex())}toDERHex(){return Le.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Pe(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const x={isValidPrivateKey(g){try{return u(g),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const g=ir(t.n);return hi(t.randomBytes(g),t.n)},precompute(g=8,E=f.BASE){return E._setWindowSize(g),E.multiply(BigInt(3)),E}};function B(g,E=!0){return f.fromPrivateKey(g).toRawBytes(E)}function R(g){const E=g instanceof Uint8Array,S=typeof g=="string",T=(E||S)&&g.length;return E?T===o||T===i:S?T===2*o||T===2*i:g instanceof f}function L(g,E,S=!0){if(R(g))throw new Error("first arg must be private key");if(!R(E))throw new Error("second arg must be public key");return f.fromHex(E).multiply(u(g)).toRawBytes(S)}const m=t.bits2int||function(g){const E=G(g),S=g.length*8-t.nBitLength;return S>0?E>>BigInt(S):E},v=t.bits2int_modN||function(g){return c(m(g))},A=Xt(t.nBitLength);function q(g){if(typeof g!="bigint")throw new Error("bigint expected");if(!(ce<=g&&g<A))throw new Error(`bigint expected < 2^${t.nBitLength}`);return Se(g,t.nByteLength)}function U(g,E,S=_){if(["recovered","canonical"].some(_e=>_e in S))throw new Error("sign() legacy options not supported");const{hash:T,randomBytes:I}=t;let{lowS:C,prehash:P,extraEntropy:N}=S;C==null&&(C=!0),g=K("msgHash",g),P&&(g=K("prehashed msgHash",T(g)));const ee=v(g),ge=u(E),Ue=[q(ge),q(ee)];if(N!=null){const _e=N===!0?I(n.BYTES):N;Ue.push(K("extraEntropy",_e))}const Ke=Te(...Ue),ye=ee;function Et(_e){const $e=m(_e);if(!w($e))return;const _n=a($e),Re=f.BASE.multiply($e).toAffine(),te=c(Re.x);if(te===ce)return;const Ce=c(_n*c(ye+te*ge));if(Ce===ce)return;let In=(Re.x===te?0:2)|Number(Re.y&X),Ln=Ce;return C&&y(Ce)&&(Ln=d(Ce),In^=1),new p(te,Ln,In)}return{seed:Ke,k2sig:Et}}const _={lowS:t.lowS,prehash:!1},O={lowS:t.lowS,prehash:!1};function H(g,E,S=_){const{seed:T,k2sig:I}=U(g,E,S),C=t;return nr(C.hash.outputLen,C.nByteLength,C.hmac)(T,I)}f.BASE._setWindowSize(8);function M(g,E,S,T=O){var Re;const I=g;if(E=K("msgHash",E),S=K("publicKey",S),"strict"in T)throw new Error("options.strict was renamed to lowS");const{lowS:C,prehash:P}=T;let N,ee;try{if(typeof I=="string"||I instanceof Uint8Array)try{N=p.fromDER(I)}catch(te){if(!(te instanceof Le.Err))throw te;N=p.fromCompact(I)}else if(typeof I=="object"&&typeof I.r=="bigint"&&typeof I.s=="bigint"){const{r:te,s:Ce}=I;N=new p(te,Ce)}else throw new Error("PARSE");ee=f.fromHex(S)}catch(te){if(te.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(C&&N.hasHighS())return!1;P&&(E=t.hash(E));const{r:ge,s:Ue}=N,Ke=v(E),ye=a(Ue),Et=c(Ke*ye),_e=c(ge*ye),$e=(Re=f.BASE.multiplyAndAddUnsafe(ee,Et,_e))==null?void 0:Re.toAffine();return $e?c($e.x)===ge:!1}return{CURVE:t,getPublicKey:B,getSharedSecret:L,sign:H,verify:M,ProjectivePoint:f,Signature:p,utils:x}}let ar=class extends Xn{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Oo(t);const r=Ft(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?t.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=t.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(t){return Qe(this),this.iHash.update(t),this}digestInto(t){Qe(this),Jn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=i,t.blockLen=s,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const cr=(e,t,n)=>new ar(e,t).update(n).digest();cr.create=(e,t)=>new ar(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function vi(e){return{hash:e,hmac:(t,...n)=>cr(e,t,Mo(...n)),randomBytes:Qn}}function Ai(e,t){const n=r=>xi({...e,...vi(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const st=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),et=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),lr=BigInt(1),tt=BigInt(2),On=(e,t)=>(e+t/tt)/t;function fr(e){const t=st,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),c=BigInt(44),a=BigInt(88),f=e*e*e%t,u=f*f*e%t,l=Y(u,n,t)*u%t,w=Y(l,n,t)*u%t,b=Y(w,tt,t)*f%t,y=Y(b,o,t)*b%t,d=Y(y,i,t)*y%t,h=Y(d,c,t)*d%t,p=Y(h,a,t)*h%t,x=Y(p,c,t)*d%t,B=Y(x,n,t)*u%t,R=Y(B,s,t)*y%t,L=Y(R,r,t)*f%t,m=Y(L,tt,t);if(!Ot.eql(Ot.sqr(m),e))throw new Error("Cannot find square root");return m}const Ot=di(st,void 0,void 0,{sqrt:fr}),je=Ai({a:BigInt(0),b:BigInt(7),Fp:Ot,n:et,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=et,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-lr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),c=On(i*e,t),a=On(-r*e,t);let f=V(e-c*n-a*o,t),u=V(-c*r-a*i,t);const l=f>s,w=u>s;if(l&&(f=t-f),w&&(u=t-u),f>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:f,k2neg:w,k2:u}}}},Ct),at=BigInt(0),ur=e=>typeof e=="bigint"&&at<e&&e<st,Si=e=>typeof e=="bigint"&&at<e&&e<et,Hn={};function nt(e,...t){let n=Hn[e];if(n===void 0){const r=Ct(Uint8Array.from(e,o=>o.charCodeAt(0)));n=Te(r,r),Hn[e]=n}return Ct(Te(n,...t))}const Qt=e=>e.toRawBytes(!0).slice(1),Ht=e=>Se(e,32),_t=e=>V(e,st),Fe=e=>V(e,et),en=je.ProjectivePoint,Bi=(e,t,n)=>en.BASE.multiplyAndAddUnsafe(e,t,n);function Pt(e){let t=je.utils.normPrivateKeyToScalar(e),n=en.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Fe(-t),bytes:Qt(n)}}function dr(e){if(!ur(e))throw new Error("bad x: need 0 < x < p");const t=_t(e*e),n=_t(t*e+BigInt(7));let r=fr(n);r%tt!==at&&(r=_t(-r));const o=new en(e,r,lr);return o.assertValidity(),o}function hr(...e){return Fe(G(nt("BIP0340/challenge",...e)))}function _i(e){return Pt(e).bytes}function Ii(e,t,n=Qn(32)){const r=K("message",e),{bytes:o,scalar:i}=Pt(t),s=K("auxRand",n,32),c=Ht(i^G(nt("BIP0340/aux",s))),a=nt("BIP0340/nonce",c,o,r),f=Fe(G(a));if(f===at)throw new Error("sign failed: k is zero");const{bytes:u,scalar:l}=Pt(f),w=hr(u,o,r),b=new Uint8Array(64);if(b.set(u,0),b.set(Ht(Fe(l+w*i)),32),!pr(b,r,o))throw new Error("sign: Invalid signature produced");return b}function pr(e,t,n){const r=K("signature",e,64),o=K("message",t),i=K("publicKey",n,32);try{const s=dr(G(i)),c=G(r.subarray(0,32));if(!ur(c))return!1;const a=G(r.subarray(32,64));if(!Si(a))return!1;const f=hr(Ht(c),Qt(s),o),u=Bi(s,a,Fe(-f));return!(!u||!u.hasEvenY()||u.toAffine().x!==c)}catch{return!1}}const We={getPublicKey:_i,sign:Ii,verify:pr,utils:{randomPrivateKey:je.utils.randomPrivateKey,lift_x:dr,pointToBytes:Qt,numberToBytesBE:Se,bytesToNumberBE:G,taggedHash:nt,mod:V}},It=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const tn=e=>e instanceof Uint8Array,Lt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),oe=(e,t)=>e<<32-t|e>>>t,Li=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Li)throw new Error("Non little-endian hardware is not supported");const Ti=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Z(e){if(!tn(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Ti[e[n]];return t}function qe(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,i=e.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function Ui(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Ge(e){if(typeof e=="string"&&(e=Ui(e)),!tn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function ct(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!tn(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}class gr{clone(){return this._cloneInto()}}function yr(e){const t=r=>e().update(Ge(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function wr(e=32){if(It&&typeof It.getRandomValues=="function")return It.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function qt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function $i(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function br(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Ri(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");qt(e.outputLen),qt(e.blockLen)}function Ci(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ki(e,t){br(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const se={number:qt,bool:$i,bytes:br,hash:Ri,exists:Ci,output:ki};function Ni(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,f=r?0:4;e.setUint32(t+a,s,r),e.setUint32(t+f,c,r)}class Oi extends gr{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Lt(this.buffer)}update(t){se.exists(this);const{view:n,buffer:r,blockLen:o}=this;t=Ge(t);const i=t.length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=Lt(t);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(t.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){se.exists(this),se.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;Ni(r,o-8,BigInt(this.length*8),i),this.process(r,0);const c=Lt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=a/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)c.setUint32(4*l,u[l],i)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return t.length=o,t.pos=c,t.finished=i,t.destroyed=s,o%n&&t.buffer.set(r),t}}const Hi=(e,t,n)=>e&t^~e&n,Pi=(e,t,n)=>e&t^e&n^t&n,qi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ee=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),me=new Uint32Array(64);class Er extends Oi{constructor(){super(64,32,8,!1),this.A=Ee[0]|0,this.B=Ee[1]|0,this.C=Ee[2]|0,this.D=Ee[3]|0,this.E=Ee[4]|0,this.F=Ee[5]|0,this.G=Ee[6]|0,this.H=Ee[7]|0}get(){const{A:t,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[t,n,r,o,i,s,c,a]}set(t,n,r,o,i,s,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)me[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const w=me[l-15],b=me[l-2],y=oe(w,7)^oe(w,18)^w>>>3,d=oe(b,17)^oe(b,19)^b>>>10;me[l]=d+me[l-7]+y+me[l-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:f,H:u}=this;for(let l=0;l<64;l++){const w=oe(c,6)^oe(c,11)^oe(c,25),b=u+w+Hi(c,a,f)+qi[l]+me[l]|0,d=(oe(r,2)^oe(r,13)^oe(r,22))+Pi(r,o,i)|0;u=f,f=a,a=c,c=s+b|0,s=i,i=o,o=r,r=b+d|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,o,i,s,c,a,f,u)}roundClean(){me.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Mi extends Er{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const ze=yr(()=>new Er);yr(()=>new Mi);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ve(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function de(...e){const t=(o,i)=>s=>o(i(s)),n=Array.from(e).reverse().reduce((o,i)=>o?t(o,i.encode):i.encode,void 0),r=e.reduce((o,i)=>o?t(o,i.decode):i.decode,void 0);return{encode:n,decode:r}}function he(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(Ve(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function pe(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function lt(e,t="="){if(Ve(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function mr(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Pn(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const o=[],i=Array.from(e);for(i.forEach(s=>{if(Ve(s),s<0||s>=t)throw new Error(`Wrong integer: ${s}`)});;){let s=0,c=!0;for(let a=r;a<i.length;a++){const f=i[a],u=t*s+f;if(!Number.isSafeInteger(u)||t*s/t!==s||u-f!==t*s)throw new Error("convertRadix: carry overflow");if(s=u%n,i[a]=Math.floor(u/n),!Number.isSafeInteger(i[a])||i[a]*n+s!==u)throw new Error("convertRadix: carry overflow");if(c)i[a]?c=!1:r=a;else continue}if(o.push(s),c)break}for(let s=0;s<e.length-1&&e[s]===0;s++)o.push(0);return o.reverse()}const xr=(e,t)=>t?xr(t,e%t):e,rt=(e,t)=>e+(t-xr(e,t));function Mt(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(rt(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${rt(t,n)}`);let o=0,i=0;const s=2**n-1,c=[];for(const a of e){if(Ve(a),a>=2**t)throw new Error(`convertRadix2: invalid data word=${a} from=${t}`);if(o=o<<t|a,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=n;i-=n)c.push((o>>i-n&s)>>>0);o&=2**i-1}if(o=o<<n-i&s,!r&&i>=t)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&i>0&&c.push(o>>>0),c}function Di(e){return Ve(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Pn(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Pn(t,e,2**8))}}}function Be(e,t=!1){if(Ve(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(rt(8,e)>32||rt(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Mt(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Mt(n,e,8,t))}}}function qn(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const ji=de(Be(4),he("0123456789ABCDEF"),pe("")),zi=de(Be(5),he("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),lt(5),pe(""));de(Be(5),he("0123456789ABCDEFGHIJKLMNOPQRSTUV"),lt(5),pe(""));de(Be(5),he("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),pe(""),mr(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const ue=de(Be(6),he("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),lt(6),pe("")),Vi=de(Be(6),he("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),lt(6),pe("")),nn=e=>de(Di(58),he(e),pe("")),Dt=nn("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");nn("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");nn("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Mn=[0,2,3,5,6,7,9,10,11],Ki={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=Dt.encode(r).padStart(Mn[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),o=Mn.indexOf(r.length),i=Dt.decode(r);for(let s=0;s<i.length-o;s++)if(i[s]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(i.slice(i.length-o)))}return Uint8Array.from(t)}},jt=de(he("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),pe("")),Dn=[996825010,642813549,513874426,1027748829,705979059];function Ze(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Dn.length;r++)(t>>r&1)===1&&(n^=Dn[r]);return n}function jn(e,t,n=1){const r=e.length;let o=1;for(let i=0;i<r;i++){const s=e.charCodeAt(i);if(s<33||s>126)throw new Error(`Invalid prefix (${e})`);o=Ze(o)^s>>5}o=Ze(o);for(let i=0;i<r;i++)o=Ze(o)^e.charCodeAt(i)&31;for(let i of t)o=Ze(o)^i;for(let i=0;i<6;i++)o=Ze(o);return o^=n,jt.encode(Mt([o%2**30],30,5,!1))}function vr(e){const t=e==="bech32"?1:734539939,n=Be(5),r=n.decode,o=n.encode,i=qn(r);function s(u,l,w=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof l}`);const b=u.length+7+l.length;if(w!==!1&&b>w)throw new TypeError(`Length ${b} exceeds limit ${w}`);return u=u.toLowerCase(),`${u}1${jt.encode(l)}${jn(u,l,t)}`}function c(u,l=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||l!==!1&&u.length>l)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${l})`);const w=u.toLowerCase();if(u!==w&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=w;const b=u.lastIndexOf("1");if(b===0||b===-1)throw new Error('Letter "1" must be present between prefix and data only');const y=u.slice(0,b),d=u.slice(b+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");const h=jt.decode(d).slice(0,-6),p=jn(y,h,t);if(!d.endsWith(p))throw new Error(`Invalid checksum in ${u}: expected "${p}"`);return{prefix:y,words:h}}const a=qn(c);function f(u){const{prefix:l,words:w}=c(u,!1);return{prefix:l,words:w,bytes:r(w)}}return{encode:s,decode:c,decodeToBytes:f,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:i,toWords:o}}const Me=vr("bech32");vr("bech32m");const Wi={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},Zi=de(Be(4),he("0123456789abcdef"),pe(""),mr(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),Fi={utf8:Wi,hex:Zi,base16:ji,base32:zi,base64:ue,base64url:Vi,base58:Dt,base58xmr:Ki};`${Object.keys(Fi).join(", ")}`;function Tt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function zn(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Gi(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function le(e,...t){if(!Gi(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const W=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Ji=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ji)throw new Error("Non little-endian hardware is not supported");function Yi(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Xi(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const Qi=(e,t)=>(Object.assign(t,e),t),Ae=16,es=283;function rn(e){return e<<1^es&-(e>>7)}function Ne(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=rn(e);return n}const zt=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=rn(r))e[n]=r;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return t})(),ts=zt.map((e,t)=>zt.indexOf(t)),ns=e=>e<<24|e>>>8,Ut=e=>e<<8|e>>>24;function Ar(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((f,u)=>t(e[u])),r=n.map(Ut),o=r.map(Ut),i=o.map(Ut),s=new Uint32Array(256*256),c=new Uint32Array(256*256),a=new Uint16Array(256*256);for(let f=0;f<256;f++)for(let u=0;u<256;u++){const l=f*256+u;s[l]=n[f]^r[u],c[l]=o[f]^i[u],a[l]=e[f]<<8|e[u]}return{sbox:e,sbox2:a,T0:n,T1:r,T2:o,T3:i,T01:s,T23:c}}const on=Ar(zt,e=>Ne(e,3)<<24|e<<16|e<<8|Ne(e,2)),Sr=Ar(ts,e=>Ne(e,11)<<24|Ne(e,13)<<16|Ne(e,9)<<8|Ne(e,14)),rs=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=rn(n))e[t]=n;return e})();function Br(e){le(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=on,r=W(e),o=r.length,i=c=>ae(n,c,c,c,c),s=new Uint32Array(t+28);s.set(r);for(let c=o;c<s.length;c++){let a=s[c-1];c%o===0?a=i(ns(a))^rs[c/o-1]:o>6&&c%o===4&&(a=i(a)),s[c]=s[c-o]^a}return s}function os(e){const t=Br(e),n=t.slice(),r=t.length,{sbox2:o}=on,{T0:i,T1:s,T2:c,T3:a}=Sr;for(let f=0;f<r;f+=4)for(let u=0;u<4;u++)n[f+u]=t[r-f-4+u];t.fill(0);for(let f=4;f<r-4;f++){const u=n[f],l=ae(o,u,u,u,u);n[f]=i[l&255]^s[l>>>8&255]^c[l>>>16&255]^a[l>>>24]}return n}function ve(e,t,n,r,o,i){return e[n<<8&65280|r>>>8&255]^t[o>>>8&65280|i>>>24&255]}function ae(e,t,n,r,o){return e[t&255|n&65280]|e[r>>>16&255|o>>>16&65280]<<16}function Vn(e,t,n,r,o){const{sbox2:i,T01:s,T23:c}=on;let a=0;t^=e[a++],n^=e[a++],r^=e[a++],o^=e[a++];const f=e.length/4-2;for(let y=0;y<f;y++){const d=e[a++]^ve(s,c,t,n,r,o),h=e[a++]^ve(s,c,n,r,o,t),p=e[a++]^ve(s,c,r,o,t,n),x=e[a++]^ve(s,c,o,t,n,r);t=d,n=h,r=p,o=x}const u=e[a++]^ae(i,t,n,r,o),l=e[a++]^ae(i,n,r,o,t),w=e[a++]^ae(i,r,o,t,n),b=e[a++]^ae(i,o,t,n,r);return{s0:u,s1:l,s2:w,s3:b}}function is(e,t,n,r,o){const{sbox2:i,T01:s,T23:c}=Sr;let a=0;t^=e[a++],n^=e[a++],r^=e[a++],o^=e[a++];const f=e.length/4-2;for(let y=0;y<f;y++){const d=e[a++]^ve(s,c,t,o,r,n),h=e[a++]^ve(s,c,n,t,o,r),p=e[a++]^ve(s,c,r,n,t,o),x=e[a++]^ve(s,c,o,r,n,t);t=d,n=h,r=p,o=x}const u=e[a++]^ae(i,t,o,r,n),l=e[a++]^ae(i,n,t,o,r),w=e[a++]^ae(i,r,n,t,o),b=e[a++]^ae(i,o,r,n,t);return{s0:u,s1:l,s2:w,s3:b}}function _r(e,t){if(!t)return new Uint8Array(e);if(le(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function ss(e){if(le(e),e.length%Ae!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Ae}`)}function as(e,t,n){let r=e.length;const o=r%Ae;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const i=W(e);if(t){let a=Ae-o;a||(a=Ae),r=r+a}const s=_r(r,n),c=W(s);return{b:i,o:c,out:s}}function cs(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const o=e.subarray(0,-r);for(let i=0;i<r;i++)if(e[n-i-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function ls(e){const t=new Uint8Array(16),n=W(t);t.set(e);const r=Ae-e.length;for(let o=Ae-r;o<Ae;o++)t[o]=r;return n}const Ir=Qi({blockSize:16,nonceLength:16},function(t,n,r={}){le(t),le(n,16);const o=!r.disablePadding;return{encrypt:(i,s)=>{const c=Br(t),{b:a,o:f,out:u}=as(i,o,s),l=W(n);let w=l[0],b=l[1],y=l[2],d=l[3],h=0;for(;h+4<=a.length;)w^=a[h+0],b^=a[h+1],y^=a[h+2],d^=a[h+3],{s0:w,s1:b,s2:y,s3:d}=Vn(c,w,b,y,d),f[h++]=w,f[h++]=b,f[h++]=y,f[h++]=d;if(o){const p=ls(i.subarray(h*4));w^=p[0],b^=p[1],y^=p[2],d^=p[3],{s0:w,s1:b,s2:y,s3:d}=Vn(c,w,b,y,d),f[h++]=w,f[h++]=b,f[h++]=y,f[h++]=d}return c.fill(0),u},decrypt:(i,s)=>{ss(i);const c=os(t),a=W(n),f=_r(i.length,s),u=W(i),l=W(f);let w=a[0],b=a[1],y=a[2],d=a[3];for(let h=0;h+4<=u.length;){const p=w,x=b,B=y,R=d;w=u[h+0],b=u[h+1],y=u[h+2],d=u[h+3];const{s0:L,s1:m,s2:v,s3:A}=is(c,w,b,y,d);l[h++]=L^p,l[h++]=m^x,l[h++]=v^B,l[h++]=A^R}return c.fill(0),cs(f,o)}}}),Lr=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),fs=Lr("expand 16-byte k"),us=Lr("expand 32-byte k"),ds=W(fs),Tr=W(us);Tr.slice();function k(e,t){return e<<t|e>>>32-t}function Vt(e){return e.byteOffset%4===0}const Ye=64,hs=16,Ur=2**32-1,Kn=new Uint32Array;function ps(e,t,n,r,o,i,s,c){const a=o.length,f=new Uint8Array(Ye),u=W(f),l=Vt(o)&&Vt(i),w=l?W(o):Kn,b=l?W(i):Kn;for(let y=0;y<a;s++){if(e(t,n,r,u,s,c),s>=Ur)throw new Error("arx: counter overflow");const d=Math.min(Ye,a-y);if(l&&d===Ye){const h=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let p=0,x;p<hs;p++)x=h+p,b[x]=w[x]^u[p];y+=Ye;continue}for(let h=0,p;h<d;h++)p=y+h,i[p]=o[p]^f[h];y+=d}}function gs(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:i,rounds:s}=Yi({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Tt(o),Tt(s),zn(i),zn(n),(c,a,f,u,l=0)=>{le(c),le(a),le(f);const w=f.length;if(u||(u=new Uint8Array(w)),le(u),Tt(l),l<0||l>=Ur)throw new Error("arx: counter overflow");if(u.length<w)throw new Error(`arx: output (${u.length}) is shorter than data (${w})`);const b=[];let y=c.length,d,h;if(y===32)d=c.slice(),b.push(d),h=Tr;else if(y===16&&n)d=new Uint8Array(32),d.set(c),d.set(c,16),h=ds,b.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);Vt(a)||(a=a.slice(),b.push(a));const p=W(d);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(h,p,W(a.subarray(0,16)),p),a=a.subarray(16)}const x=16-o;if(x!==a.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const R=new Uint8Array(12);R.set(a,i?0:12-a.length),a=R,b.push(a)}const B=W(a);for(ps(e,h,p,B,f,u,l,s);b.length>0;)b.pop().fill(0);return u}}function ys(e,t,n,r,o,i=20){let s=e[0],c=e[1],a=e[2],f=e[3],u=t[0],l=t[1],w=t[2],b=t[3],y=t[4],d=t[5],h=t[6],p=t[7],x=o,B=n[0],R=n[1],L=n[2],m=s,v=c,A=a,q=f,U=u,_=l,O=w,H=b,M=y,g=d,E=h,S=p,T=x,I=B,C=R,P=L;for(let ee=0;ee<i;ee+=2)m=m+U|0,T=k(T^m,16),M=M+T|0,U=k(U^M,12),m=m+U|0,T=k(T^m,8),M=M+T|0,U=k(U^M,7),v=v+_|0,I=k(I^v,16),g=g+I|0,_=k(_^g,12),v=v+_|0,I=k(I^v,8),g=g+I|0,_=k(_^g,7),A=A+O|0,C=k(C^A,16),E=E+C|0,O=k(O^E,12),A=A+O|0,C=k(C^A,8),E=E+C|0,O=k(O^E,7),q=q+H|0,P=k(P^q,16),S=S+P|0,H=k(H^S,12),q=q+H|0,P=k(P^q,8),S=S+P|0,H=k(H^S,7),m=m+_|0,P=k(P^m,16),E=E+P|0,_=k(_^E,12),m=m+_|0,P=k(P^m,8),E=E+P|0,_=k(_^E,7),v=v+O|0,T=k(T^v,16),S=S+T|0,O=k(O^S,12),v=v+O|0,T=k(T^v,8),S=S+T|0,O=k(O^S,7),A=A+H|0,I=k(I^A,16),M=M+I|0,H=k(H^M,12),A=A+H|0,I=k(I^A,8),M=M+I|0,H=k(H^M,7),q=q+U|0,C=k(C^q,16),g=g+C|0,U=k(U^g,12),q=q+U|0,C=k(C^q,8),g=g+C|0,U=k(U^g,7);let N=0;r[N++]=s+m|0,r[N++]=c+v|0,r[N++]=a+A|0,r[N++]=f+q|0,r[N++]=u+U|0,r[N++]=l+_|0,r[N++]=w+O|0,r[N++]=b+H|0,r[N++]=y+M|0,r[N++]=d+g|0,r[N++]=h+E|0,r[N++]=p+S|0,r[N++]=x+T|0,r[N++]=B+I|0,r[N++]=R+C|0,r[N++]=L+P|0}const $r=gs(ys,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Rr extends gr{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,se.hash(t);const r=Ge(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?t.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=t.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(t){return se.exists(this),this.iHash.update(t),this}digestInto(t){se.exists(this),se.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=i,t.blockLen=s,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ft=(e,t,n)=>new Rr(e,t).update(n).digest();ft.create=(e,t)=>new Rr(e,t);function ws(e,t,n){return se.hash(e),ft(e,Ge(n),Ge(t))}const $t=new Uint8Array([0]),Wn=new Uint8Array;function bs(e,t,n,r=32){if(se.hash(e),se.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/e.outputLen);n===void 0&&(n=Wn);const i=new Uint8Array(o*e.outputLen),s=ft.create(e,t),c=s._cloneInto(),a=new Uint8Array(s.outputLen);for(let f=0;f<o;f++)$t[0]=f+1,c.update(f===0?Wn:a).update(n).update($t).digestInto(a),i.set(a,e.outputLen*f),s._cloneInto(c);return s.destroy(),c.destroy(),a.fill(0),$t.fill(0),i.slice(0,r)}var Es=Object.defineProperty,D=(e,t)=>{for(var n in t)Es(e,n,{get:t[n],enumerable:!0})},ke=Symbol("verified"),ms=e=>e instanceof Object;function sn(e){if(!ms(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}var xs={};D(xs,{Queue:()=>Nr,QueueNode:()=>kr,binarySearch:()=>an,insertEventIntoAscendingList:()=>As,insertEventIntoDescendingList:()=>vs,normalizeURL:()=>Cr,utf8Decoder:()=>fe,utf8Encoder:()=>ne});var fe=new TextDecoder("utf-8"),ne=new TextEncoder;function Cr(e){e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function vs(e,t){const[n,r]=an(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return r||e.splice(n,0,t),e}function As(e,t){const[n,r]=an(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return r||e.splice(n,0,t),e}function an(e,t){let n=0,r=e.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),i=t(e[o]);if(i===0)return[o,!0];i<0?r=o-1:n=o+1}return[n,!1]}var kr=class{constructor(e){$(this,"value");$(this,"next",null);$(this,"prev",null);this.value=e}},Nr=class{constructor(){$(this,"first");$(this,"last");this.first=null,this.last=null}enqueue(e){const t=new kr(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,e.value}},Ss=class{generateSecretKey(){return We.utils.randomPrivateKey()}getPublicKey(e){return Z(We.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=Z(We.getPublicKey(t)),n.id=Xe(n),n.sig=Z(We.sign(Xe(n),t)),n[ke]=!0,n}verifyEvent(e){if(typeof e[ke]=="boolean")return e[ke];const t=Xe(e);if(t!==e.id)return e[ke]=!1,!1;try{const n=We.verify(e.sig,t,e.pubkey);return e[ke]=n,n}catch{return e[ke]=!1,!1}}};function Bs(e){if(!sn(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Xe(e){let t=ze(ne.encode(Bs(e)));return Z(t)}var ut=new Ss,Or=ut.generateSecretKey,cn=ut.getPublicKey,Q=ut.finalizeEvent,dt=ut.verifyEvent,_s={};D(_s,{Application:()=>La,BadgeAward:()=>Ns,BadgeDefinition:()=>xa,BlockedRelaysList:()=>ia,BookmarkList:()=>na,Bookmarksets:()=>ba,Calendar:()=>Na,CalendarEventRSVP:()=>Oa,ChannelCreation:()=>jr,ChannelHideMessage:()=>Kr,ChannelMessage:()=>Vr,ChannelMetadata:()=>zr,ChannelMuteUser:()=>Wr,ClassifiedListing:()=>$a,ClientAuth:()=>Fr,CommunitiesList:()=>ra,CommunityDefinition:()=>qa,CommunityPostApproval:()=>Ks,Contacts:()=>Rs,CreateOrUpdateProduct:()=>Sa,CreateOrUpdateStall:()=>Aa,Curationsets:()=>Ea,Date:()=>Ca,DirectMessageRelaysList:()=>la,DraftClassifiedListing:()=>Ra,DraftLong:()=>_a,Emojisets:()=>Ia,EncryptedDirectMessage:()=>Cs,EventDeletion:()=>ks,FileMetadata:()=>qs,FileServerPreference:()=>fa,Followsets:()=>ga,GenericRepost:()=>Hs,Genericlists:()=>ya,GiftWrap:()=>Zr,HTTPAuth:()=>un,Handlerinformation:()=>Pa,Handlerrecommendation:()=>Ha,Highlights:()=>Xs,InterestsList:()=>aa,Interestsets:()=>va,JobFeedback:()=>Fs,JobRequest:()=>Ws,JobResult:()=>Zs,Label:()=>Vs,LightningPubRPC:()=>da,LiveChatMessage:()=>Ms,LiveEvent:()=>Ta,LongFormArticle:()=>Ba,Metadata:()=>Ts,Mutelist:()=>Qs,NWCWalletInfo:()=>ua,NWCWalletRequest:()=>Gr,NWCWalletResponse:()=>ha,NostrConnect:()=>pa,OpenTimestamps:()=>Ps,Pinlist:()=>ea,PrivateDirectMessage:()=>Os,ProblemTracker:()=>Ds,ProfileBadges:()=>ma,PublicChatsList:()=>oa,Reaction:()=>fn,RecommendRelay:()=>$s,RelayList:()=>ta,Relaysets:()=>wa,Report:()=>js,Reporting:()=>zs,Repost:()=>ln,Seal:()=>Dr,SearchRelaysList:()=>sa,ShortTextNote:()=>Us,Time:()=>ka,UserEmojiList:()=>ca,UserStatuses:()=>Ua,Zap:()=>Ys,ZapGoal:()=>Gs,ZapRequest:()=>Js,classifyKind:()=>Is,isEphemeralKind:()=>qr,isKind:()=>Ls,isParameterizedReplaceableKind:()=>Mr,isRegularKind:()=>Hr,isReplaceableKind:()=>Pr});function Hr(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Pr(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function qr(e){return 2e4<=e&&e<3e4}function Mr(e){return 3e4<=e&&e<4e4}function Is(e){return Hr(e)?"regular":Pr(e)?"replaceable":qr(e)?"ephemeral":Mr(e)?"parameterized":"unknown"}function Ls(e,t){const n=t instanceof Array?t:[t];return sn(e)&&n.includes(e.kind)||!1}var Ts=0,Us=1,$s=2,Rs=3,Cs=4,ks=5,ln=6,fn=7,Ns=8,Dr=13,Os=14,Hs=16,jr=40,zr=41,Vr=42,Kr=43,Wr=44,Ps=1040,Zr=1059,qs=1063,Ms=1311,Ds=1971,js=1984,zs=1984,Vs=1985,Ks=4550,Ws=5999,Zs=6999,Fs=7e3,Gs=9041,Js=9734,Ys=9735,Xs=9802,Qs=1e4,ea=10001,ta=10002,na=10003,ra=10004,oa=10005,ia=10006,sa=10007,aa=10015,ca=10030,la=10050,fa=10096,ua=13194,da=21e3,Fr=22242,Gr=23194,ha=23195,pa=24133,un=27235,ga=3e4,ya=30001,wa=30002,ba=30003,Ea=30004,ma=30008,xa=30009,va=30015,Aa=30017,Sa=30018,Ba=30023,_a=30024,Ia=30030,La=30078,Ta=30311,Ua=30315,$a=30402,Ra=30403,Ca=31922,ka=31923,Na=31924,Oa=31925,Ha=31989,Pa=31990,qa=34550;function Ma(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),o=e[`#${r}`];if(o&&!t.tags.find(([i,s])=>i===n.slice(1)&&o.indexOf(s)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function Da(e,t){for(let n=0;n<e.length;n++)if(Ma(e[n],t))return!0;return!1}var ja={};D(ja,{getHex64:()=>ht,getInt:()=>Jr,getSubscriptionId:()=>Yr,matchEventId:()=>za,matchEventKind:()=>Ka,matchEventPubkey:()=>Va});function ht(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function Jr(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,o=e.slice(r),i=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,i),10)}function Yr(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(o===-1)return null;let i=r+1+o;return e.slice(r+1,i)}function za(e,t){return t===ht(e,"id")}function Va(e,t){return t===ht(e,"pubkey")}function Ka(e,t){return t===Jr(e,"kind")}var Wa={};D(Wa,{makeAuthEvent:()=>Xr});function Xr(e,t){return{kind:Fr,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function Za(){return new Promise(e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var Qr=class{constructor(e,t){$(this,"url");$(this,"_connected",!1);$(this,"onclose",null);$(this,"onnotice",e=>console.debug(`NOTICE from ${this.url}: ${e}`));$(this,"_onauth",null);$(this,"baseEoseTimeout",4400);$(this,"connectionTimeout",4400);$(this,"publishTimeout",4400);$(this,"openSubs",new Map);$(this,"connectionTimeoutHandle");$(this,"connectionPromise");$(this,"openCountRequests",new Map);$(this,"openEventPublishes",new Map);$(this,"ws");$(this,"incomingMessageQueue",new Nr);$(this,"queueRunning",!1);$(this,"challenge");$(this,"serial",0);$(this,"verifyEvent");$(this,"_WebSocket");this.url=Cr(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const n=new Qr(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{var n;t("connection timed out"),this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=n=>{var r;t(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,(r=this.onclose)==null||r.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var n;this._connected&&(this._connected=!1,this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Za();this.queueRunning=!1}handleNext(){var n,r,o;const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=Yr(e);if(t){const i=this.openSubs.get(t);if(!i)return;const s=ht(e,"id"),c=(n=i.alreadyHaveEvent)==null?void 0:n.call(i,s);if((r=i.receivedEvent)==null||r.call(i,this,s),c)return}try{let i=JSON.parse(e);switch(i[0]){case"EVENT":{const s=this.openSubs.get(i[1]),c=i[2];this.verifyEvent(c)&&Da(s.filters,c)&&s.onevent(c);return}case"COUNT":{const s=i[1],c=i[2],a=this.openCountRequests.get(s);a&&(a.resolve(c.count),this.openCountRequests.delete(s));return}case"EOSE":{const s=this.openSubs.get(i[1]);if(!s)return;s.receivedEose();return}case"OK":{const s=i[1],c=i[2],a=i[3],f=this.openEventPublishes.get(s);f&&(c?f.resolve(a):f.reject(new Error(a)),this.openEventPublishes.delete(s));return}case"CLOSED":{const s=i[1],c=this.openSubs.get(s);if(!c)return;c.closed=!0,c.close(i[2]);return}case"NOTICE":this.onnotice(i[1]);return;case"AUTH":{this.challenge=i[1],(o=this._onauth)==null||o.call(this,i[1]);return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{var t;(t=this.ws)==null||t.send(e)})}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(Xr(this.url,this.challenge)),n=new Promise((r,o)=>{this.openEventPublishes.set(t.id,{resolve:r,reject:o})});return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){const t=new Promise((n,r)=>{this.openEventPublishes.set(e.id,{resolve:n,reject:r})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),setTimeout(()=>{const n=this.openEventPublishes.get(e.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout),t}async count(e,t){this.serial++;const n=(t==null?void 0:t.id)||"count:"+this.serial,r=new Promise((o,i)=>{this.openCountRequests.set(n,{resolve:o,reject:i})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new Fa(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,(e=this.ws)==null||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Fa=class{constructor(e,t,n,r){$(this,"relay");$(this,"id");$(this,"closed",!1);$(this,"eosed",!1);$(this,"filters");$(this,"alreadyHaveEvent");$(this,"receivedEvent");$(this,"onevent");$(this,"oneose");$(this,"onclose");$(this,"eoseTimeout");$(this,"eoseTimeoutHandle");this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,(e=this.oneose)==null||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),(t=this.onclose)==null||t.call(this,e)}},eo;try{eo=WebSocket}catch{}var to=class extends Qr{constructor(e){super(e,{verifyEvent:dt,websocketImplementation:eo})}static async connect(e){const t=new to(e);return await t.connect(),t}},Ga;try{Ga=WebSocket}catch{}var Ja={};D(Ja,{BECH32_REGEX:()=>no,Bech32MaxSize:()=>dn,NostrTypeGuard:()=>Ya,decode:()=>pt,encodeBytes:()=>yt,naddrEncode:()=>oc,neventEncode:()=>rc,noteEncode:()=>tc,nprofileEncode:()=>nc,npubEncode:()=>ec,nsecEncode:()=>Qa});var Ya={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},dn=5e3,no=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Xa(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function pt(e){var o,i,s,c,a,f,u;let{prefix:t,words:n}=Me.decode(e,dn),r=new Uint8Array(Me.fromWords(n));switch(t){case"nprofile":{let l=Rt(r);if(!((o=l[0])!=null&&o[0]))throw new Error("missing TLV 0 for nprofile");if(l[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Z(l[0][0]),relays:l[1]?l[1].map(w=>fe.decode(w)):[]}}}case"nevent":{let l=Rt(r);if(!((i=l[0])!=null&&i[0]))throw new Error("missing TLV 0 for nevent");if(l[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(l[2]&&l[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(l[3]&&l[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Z(l[0][0]),relays:l[1]?l[1].map(w=>fe.decode(w)):[],author:(s=l[2])!=null&&s[0]?Z(l[2][0]):void 0,kind:(c=l[3])!=null&&c[0]?parseInt(Z(l[3][0]),16):void 0}}}case"naddr":{let l=Rt(r);if(!((a=l[0])!=null&&a[0]))throw new Error("missing TLV 0 for naddr");if(!((f=l[2])!=null&&f[0]))throw new Error("missing TLV 2 for naddr");if(l[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((u=l[3])!=null&&u[0]))throw new Error("missing TLV 3 for naddr");if(l[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:fe.decode(l[0][0]),pubkey:Z(l[2][0]),kind:parseInt(Z(l[3][0]),16),relays:l[1]?l[1].map(w=>fe.decode(w)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:Z(r)};default:throw new Error(`unknown prefix ${t}`)}}function Rt(e){let t={},n=e;for(;n.length>0;){let r=n[0],o=n[1],i=n.slice(2,2+o);if(n=n.slice(2+o),i.length<o)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(i)}return t}function Qa(e){return yt("nsec",e)}function ec(e){return yt("npub",qe(e))}function tc(e){return yt("note",qe(e))}function gt(e,t){let n=Me.toWords(t);return Me.encode(e,n,dn)}function yt(e,t){return gt(e,t)}function nc(e){let t=hn({0:[qe(e.pubkey)],1:(e.relays||[]).map(n=>ne.encode(n))});return gt("nprofile",t)}function rc(e){let t;e.kind!==void 0&&(t=Xa(e.kind));let n=hn({0:[qe(e.id)],1:(e.relays||[]).map(r=>ne.encode(r)),2:e.author?[qe(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return gt("nevent",n)}function oc(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=hn({0:[ne.encode(e.identifier)],1:(e.relays||[]).map(r=>ne.encode(r)),2:[qe(e.pubkey)],3:[new Uint8Array(t)]});return gt("naddr",n)}function hn(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(o=>{let i=new Uint8Array(o.length+2);i.set([parseInt(n)],0),i.set([o.length],1),i.set(o,2),t.push(i)})}),ct(...t)}var ic={};D(ic,{decrypt:()=>sc,encrypt:()=>ro});async function ro(e,t,n){const r=e instanceof Uint8Array?Z(e):e,o=je.getSharedSecret(r,"02"+t),i=oo(o);let s=Uint8Array.from(wr(16)),c=ne.encode(n),a=Ir(i,s).encrypt(c),f=ue.encode(new Uint8Array(a)),u=ue.encode(new Uint8Array(s.buffer));return`${f}?iv=${u}`}async function sc(e,t,n){const r=e instanceof Uint8Array?Z(e):e;let[o,i]=n.split("?iv="),s=je.getSharedSecret(r,"02"+t),c=oo(s),a=ue.decode(i),f=ue.decode(o),u=Ir(c,a).decrypt(f);return fe.decode(u)}function oo(e){return e.slice(1,33)}var ac={};D(ac,{NIP05_REGEX:()=>pn,isNip05:()=>cc,isValid:()=>uc,queryProfile:()=>io,searchDomain:()=>fc,useFetchImplementation:()=>lc});var pn=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,cc=e=>pn.test(e||""),wt;try{wt=fetch}catch{}function lc(e){wt=e}async function fc(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await wt(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function io(e){var o;const t=e.match(pn);if(!t)return null;const[,n="_",r]=t;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await wt(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const c=await s.json(),a=c.names[n];return a?{pubkey:a,relays:(o=c.relays)==null?void 0:o[a]}:null}catch{return null}}async function uc(e,t){const n=await io(t);return n?n.pubkey===e:!1}var dc={};D(dc,{parse:()=>hc});function hc(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let o=e.tags.length-1;o>=0;o--){const i=e.tags[o];if(i[0]==="e"&&i[1]){const[s,c,a,f,u]=i,l={id:c,relays:a?[a]:[],author:u};if(f==="root"){t.root=l;continue}if(f==="reply"){t.reply=l;continue}if(f==="mention"){t.mentions.push(l);continue}n?r=l:n=l,t.mentions.push(l);continue}if(i[0]==="q"&&i[1]){const[s,c,a]=i;t.quotes.push({id:c,relays:a?[a]:[]})}if(i[0]==="p"&&i[1]){t.profiles.push({pubkey:i[1],relays:i[2]?[i[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let i=t.mentions.indexOf(o);if(i!==-1&&t.mentions.splice(i,1),o.author){let s=t.profiles.find(c=>c.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(c=>{var a;((a=o.relays)==null?void 0:a.indexOf(c))===-1&&o.relays.push(c)}),s.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let i=t.profiles.find(s=>s.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(s=>{o.relays.indexOf(s)===-1&&o.relays.push(s)}),i.relays=o.relays)}}),t}var pc={};D(pc,{fetchRelayInformation:()=>yc,useFetchImplementation:()=>gc});var so;try{so=fetch}catch{}function gc(e){so=e}async function yc(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var ao={};D(ao,{fastEventHash:()=>lo,getPow:()=>co,minePow:()=>wc});function co(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function wc(e,t){let n=0;const r=e,o=["nonce",n.toString(),t.toString()];for(r.tags.push(o);;){const i=Math.floor(new Date().getTime()/1e3);if(i!==r.created_at&&(n=0,r.created_at=i),o[1]=(++n).toString(),r.id=lo(r),co(r.id)>=t)break}return r}function lo(e){return Z(ze(ne.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var bc={};D(bc,{finishRepostEvent:()=>Ec,getRepostedEvent:()=>mc,getRepostedEventPointer:()=>fo});function Ec(e,t,n,r){return Q({kind:ln,tags:[...e.tags??[],["e",t.id,n],["p",t.pubkey]],content:e.content===""?"":JSON.stringify(t),created_at:e.created_at},r)}function fo(e){if(e.kind!==ln)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(t!==void 0)return{id:t[1],relays:[t[2],n==null?void 0:n[2]].filter(r=>typeof r=="string"),author:n==null?void 0:n[1]}}function mc(e,{skipVerification:t}={}){const n=fo(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!dt(r)))return r}var xc={};D(xc,{NOSTR_URI_REGEX:()=>bt,parse:()=>Ac,test:()=>vc});var bt=new RegExp(`nostr:(${no.source})`);function vc(e){return typeof e=="string"&&new RegExp(`^${bt.source}$`).test(e)}function Ac(e){const t=e.match(new RegExp(`^${bt.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:pt(t[1])}}var Sc={};D(Sc,{finishReactionEvent:()=>Bc,getReactedEventPointer:()=>_c});function Bc(e,t,n){const r=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return Q({...e,kind:fn,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function _c(e){if(e.kind!==fn)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Ic={};D(Ic,{matchAll:()=>Lc,regex:()=>gn,replaceAll:()=>Tc});var gn=()=>new RegExp(`\\b${bt.source}\\b`,"g");function*Lc(e){const t=e.matchAll(gn());for(const n of t)try{const[r,o]=n;yield{uri:r,value:o,decoded:pt(o),start:n.index,end:n.index+r.length}}catch{}}function Tc(e,t){return e.replaceAll(gn(),(n,r)=>t({uri:n,value:r,decoded:pt(r)}))}var Uc={};D(Uc,{channelCreateEvent:()=>$c,channelHideMessageEvent:()=>kc,channelMessageEvent:()=>Cc,channelMetadataEvent:()=>Rc,channelMuteUserEvent:()=>Nc});var $c=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Q({kind:jr,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},Rc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Q({kind:zr,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Cc=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),Q({kind:Vr,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},kc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Q({kind:Kr,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Nc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Q({kind:Wr,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},Oc={};D(Oc,{EMOJI_SHORTCODE_REGEX:()=>uo,matchAll:()=>Hc,regex:()=>yn,replaceAll:()=>Pc});var uo=/:(\w+):/,yn=()=>new RegExp(`\\B${uo.source}\\B`,"g");function*Hc(e){const t=e.matchAll(yn());for(const n of t)try{const[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function Pc(e,t){return e.replaceAll(yn(),(n,r)=>t({shortcode:n,name:r}))}var qc={};D(qc,{useFetchImplementation:()=>Mc,validateGithub:()=>Dc});var wn;try{wn=fetch}catch{}function Mc(e){wn=e}async function Dc(e,t,n){try{return await(await wn(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var jc={};D(jc,{decrypt:()=>xn,encrypt:()=>mn,getConversationKey:()=>bn,v2:()=>Zc});var ho=1,po=65535;function bn(e,t){const n=je.getSharedSecret(e,"02"+t).subarray(1,33);return ws(ze,n,"nip44-v2")}function go(e,t){const n=bs(ze,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function En(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function zc(e){if(!Number.isSafeInteger(e)||e<ho||e>po)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function Vc(e){const t=ne.encode(e),n=t.length,r=zc(n),o=new Uint8Array(En(n)-n);return ct(r,t,o)}function Kc(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<ho||t>po||n.length!==t||e.length!==2+En(t))throw new Error("invalid padding");return fe.decode(n)}function yo(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=ct(n,t);return ft(ze,e,r)}function Wc(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=ue.decode(e)}catch(i){throw new Error("invalid base64: "+i.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function mn(e,t,n=wr(32)){const{chacha_key:r,chacha_nonce:o,hmac_key:i}=go(t,n),s=Vc(e),c=$r(r,o,s),a=yo(i,c,n);return ue.encode(ct(new Uint8Array([2]),n,c,a))}function xn(e,t){const{nonce:n,ciphertext:r,mac:o}=Wc(e),{chacha_key:i,chacha_nonce:s,hmac_key:c}=go(t,n),a=yo(c,r,n);if(!Xi(a,o))throw new Error("invalid MAC");const f=$r(i,s,r);return Kc(f)}var Zc={utils:{getConversationKey:bn,calcPaddedLen:En},encrypt:mn,decrypt:xn},Fc={};D(Fc,{makeNwcRequestEvent:()=>Jc,parseConnectionString:()=>Gc});function Gc(e){const{pathname:t,searchParams:n}=new URL(e),r=t,o=n.get("relay"),i=n.get("secret");if(!r||!o||!i)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:i}}async function Jc(e,t,n){const o=await ro(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),i={kind:Gr,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return Q(i,t)}var Yc={};D(Yc,{getZapEndpoint:()=>Qc,makeZapReceipt:()=>nl,makeZapRequest:()=>el,useFetchImplementation:()=>Xc,validateZapRequest:()=>tl});var vn;try{vn=fetch}catch{}function Xc(e){vn=e}async function Qc(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:s}=Me.decode(n,1e3),c=Me.fromWords(s);t=fe.decode(c)}else if(r){let[s,c]=r.split("@");t=new URL(`/.well-known/lnurlp/${s}`,`https://${c}`).toString()}else return null;let i=await(await vn(t)).json();if(i.allowsNostr&&i.nostrPubkey)return i.callback}catch{}return null}function el({profile:e,event:t,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let i={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e],["amount",n.toString()],["relays",...r]]};return t&&i.tags.push(["e",t]),i}function tl(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!sn(t))return"Zap request is not a valid Nostr event.";if(!dt(t))return"Invalid signature on zap request.";let n=t.tags.find(([i,s])=>i==="p"&&s);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([i,s])=>i==="e"&&s);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([i,s])=>i==="relays"&&s)?null:"Zap request doesn't have a 'relays' tag."}function nl({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let o=JSON.parse(e),i=o.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),s={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...i,["P",o.pubkey],["bolt11",n],["description",e]]};return t&&s.tags.push(["preimage",t]),s}var rl={};D(rl,{createRumor:()=>xo,createSeal:()=>vo,createWrap:()=>Ao,unwrapEvent:()=>So,unwrapManyEvents:()=>sl,wrapEvent:()=>Kt,wrapManyEvents:()=>il});var ol=2*24*60*60,wo=()=>Math.round(Date.now()/1e3),bo=()=>Math.round(wo()-Math.random()*ol),Eo=(e,t)=>bn(e,t),mo=(e,t,n)=>mn(JSON.stringify(e),Eo(t,n)),Zn=(e,t)=>JSON.parse(xn(e.content,Eo(t,e.pubkey)));function xo(e,t){const n={created_at:wo(),content:"",tags:[],...e,pubkey:cn(t)};return n.id=Xe(n),n}function vo(e,t,n){return Q({kind:Dr,content:mo(e,t,n),created_at:bo(),tags:[]},t)}function Ao(e,t){const n=Or();return Q({kind:Zr,content:mo(e,n,t),created_at:bo(),tags:[["p",t]]},n)}function Kt(e,t,n){const r=xo(e,t),o=vo(r,t,n);return Ao(o,n)}function il(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=cn(t),o=[Kt(e,t,r)];return n.forEach(i=>{o.push(Kt(e,t,i))}),o}function So(e,t){const n=Zn(e,t);return Zn(n,t)}function sl(e,t){let n=[];return e.forEach(r=>{n.push(So(r,t))}),n.sort((r,o)=>r.created_at-o.created_at),n}var al={};D(al,{getToken:()=>cl,hashPayload:()=>An,unpackEventFromToken:()=>_o,validateEvent:()=>Ro,validateEventKind:()=>Lo,validateEventMethodTag:()=>Uo,validateEventPayloadTag:()=>$o,validateEventTimestamp:()=>Io,validateEventUrlTag:()=>To,validateToken:()=>ll});var Bo="Nostr ";async function cl(e,t,n,r=!1,o){const i={kind:un,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&i.tags.push(["payload",An(o)]);const s=await n(i);return(r?Bo:"")+ue.encode(ne.encode(JSON.stringify(s)))}async function ll(e,t,n){const r=await _o(e).catch(i=>{throw i});return await Ro(r,t,n).catch(i=>{throw i})}async function _o(e){if(!e)throw new Error("Missing token");e=e.replace(Bo,"");const t=fe.decode(ue.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function Io(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function Lo(e){return e.kind===un}function To(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function Uo(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function An(e){const t=ze(ne.encode(JSON.stringify(e)));return Z(t)}function $o(e,t){const n=e.tags.find(o=>o[0]==="payload");if(!n)return!1;const r=An(t);return n.length>0&&n[1]===r}async function Ro(e,t,n,r){if(!dt(e))throw new Error("Invalid nostr event, signature invalid");if(!Lo(e))throw new Error("Invalid nostr event, kind invalid");if(!Io(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!To(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!Uo(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!$o(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function fl(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function ul(e,...t){if(!fl(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dl=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function hl(e){ul(e);let t="";for(let n=0;n<e.length;n++)t+=dl[e[n]];return t}var J,xe;class Fn extends EventTarget{constructor(n=null){super();mt(this,J,null);mt(this,xe,null);xt(this,J,new RTCPeerConnection([{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}])),xt(this,xe,F(this,J).createDataChannel("sendDataChannel")),F(this,J).onicecandidate=o=>{var i;(i=o==null?void 0:o.candidate)!=null&&i.candidate&&this.dispatchEvent(new CustomEvent("icecandidate",{detail:o.candidate}))},F(this,xe).onopen=()=>F(this,xe).send("Hello World!"),F(this,xe).onclose=()=>console.log("Closed data channel"),F(this,J).ondatachannel=o=>o.channel.onmessage=i=>console.log(i.data);const r=o=>{F(this,J).setLocalDescription(o),this.dispatchEvent(new CustomEvent("description",{detail:o}))};n?(F(this,J).setRemoteDescription(n),F(this,J).createAnswer().then(r,o=>console.error(o))):F(this,J).createOffer().then(r,o=>console.error(o))}async addIceCandidate(n){return F(this,J).addIceCandidate(n)}async addDescription(n){return F(this,J).setRemoteDescription(n)}send(n){F(this,xe).send(n)}}J=new WeakMap,xe=new WeakMap;function pl(){try{return JSON.parse(sessionStorage.getItem(De)??"{}")}catch{return sessionStorage.setItem(De,"{}"),{}}}function gl(e){sessionStorage.setItem(De,JSON.stringify(e))}function yl(){const e=pl();let t=e["nostr-secure-key"];return t||(t=hl(Or()),e["nostr-secure-key"]=t,gl(e)),t}const Sn={desc:null,ice:[]};let Gn=null;function wl(e){Sn.desc=e,Co()}function bl(e){Sn.ice.push(e),Co()}function Co(){clearTimeout(Gn),Gn=setTimeout(()=>{Oe.publish(Q(ao.minePow({kind:25314,created_at:Math.floor(Date.now()/1e3),tags:[["d",De]],content:JSON.stringify(Sn)},10),Bn))},500)}const El="wss://nostr.oxtr.dev/",De="7002430c-90e5-4593-87cb-c6262fdad1d6",Bn=yl(),ml=cn(Bn);let Wt=[],Zt=null,ie=null,Oe=null;async function xl(){Oe=await to.connect(El),console.log(`Connected to relay ${Oe.url}`),Oe.subscribe([{kinds:[25313,25314,25315],"#d":[De],since:Math.floor(Date.now()/1e3)}],{async onevent(e){if(e.pubkey!==ml){if(e.kind===25314){const t=JSON.parse(e.content);if(ie){await ie.addDescription(t.desc),console.log("Added remote description");for(const n of t.ice)await ie.addIceCandidate(n),console.log("Added ice candidate")}else{for(const n of t.ice)Wt.push(n);Zt=t.desc}}console.log(e)}},oneose(){}})}window.onbeforeunload=()=>{Oe.close()};function vl(){ie||(Zt?(ie=new Fn(Zt),console.log("Added pending description")):ie=new Fn,console.log("Created peer"),Wt.length&&(Wt.forEach(e=>ie.addIceCandidate(e)),console.log("Added pending ice candidates")),ie.addEventListener("icecandidate",e=>{bl(e.detail)}),ie.addEventListener("description",e=>{wl(e.detail)}))}document.querySelector("#connect").addEventListener("click",()=>{xl()});document.querySelector("#test").addEventListener("click",async()=>{await Oe.publish(Q({kind:25313,created_at:Math.floor(Date.now()/1e3),tags:[["d",De]],content:"testing"},Bn))});document.querySelector("#start").addEventListener("click",vl);document.querySelector("#message-form").addEventListener("submit",e=>{e.preventDefault();const t=new FormData(e.target);e.target.reset(),ie.send(t.get("message"))});
